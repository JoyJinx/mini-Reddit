<% layout("layouts/boilerplate") %>

<div class="row">
  <div class="col-6 mt-5">
    <div class="card mb-5">
      <div class="card-header">
        <div class="card-title"><%= foundPage.title %></div>
        <span>-By <%= foundPage.author.username %></span>
      </div>
      <div class="col-4 offset-4">
        <img class="img-fluid my-2" src="<%= foundPage.img.path %>" />
      </div>
      <div class="card-body"><%= foundPage.body %></div>
      <div class="card-footer d-flex justify-content-between">
        <form
          id="likeForm"
          action="/p/<%= foundPage._id  %>/like"
          method="POST"
        >
          <span class="mr-auto">
            <% if (currentUser && foundPage.likes.includes(currentUser._id)) {
            %>
            <button class="btn">
              <i class="fa-solid fa-lg fa-heart" style="color: #e01b24"></i>
            </button>
            <% }else { %>
            <button class="btn">
              <i class="fa-regular fa-lg fa-heart" style="color: #e01b24"></i>
            </button>
            <% } %> <%= foundPage.likes.length %></span
          >
        </form>
        <div class="d-flex">
          <div>
            <a class="btn btn-sm btn-secondary" type="button" href="/p">Back</a>
          </div>
          <% if(currentUser && foundPage.author.equals(currentUser)) {%>
          <div>
            <a
              class="mx-1 btn btn-sm btn-info"
              type="button"
              href="/p/<%= foundPage._id %>/edit"
              >Edit</a
            >
          </div>
          <form action="/p/<%= foundPage._id %>?_method=DELETE" method="POST">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <div class="col-6 mt-4">
    <form
      class="needs-validation"
      action="/p/<%= foundPage._id %>/comments"
      method="POST"
      novalidate
    >
      <div class="card-header">
        <div class="form-group">
          <label for="exampleFormControlTextarea1">Comment text</label>
          <textarea
            class="form-control"
            id="exampleFormControlTextarea1"
            rows="3"
            placeholder="Write here..."
            name="comment[body]"
            required
          ></textarea>
        </div>
      </div>

      <div class="card-footer">
        <button class="mt-1 btn btn-sm btn-success">Submit</button>
      </div>
    </form>
    <div class="mt-3">
      <% for (let comment of foundPage.comments) {%>
      <div class="card">
        <div class="card-header">-By <%= comment.author.username %></div>
        <div class="card-body"><%= comment.body %></div>

        <div class="card-footer d-flex justify-content-between">
          <div>
            <form
              id="likeComment"
              action="/p/<%= foundPage._id  %>/comments/<%= comment._id %>"
              method="POST"
            >
              <span class="mr-auto">
                <% if (currentUser && comment.likes.includes(currentUser._id)) {
                %>
                <button class="btn">
                  <i class="fa-solid fa-lg fa-heart" style="color: #e01b24"></i>
                </button>
                <% }else { %>
                <button class="btn">
                  <i
                    class="fa-regular fa-lg fa-heart"
                    style="color: #e01b24"
                  ></i>
                </button>
                <% } %> <%= comment.likes.length %></span
              >
            </form>
          </div>
          <% if(currentUser && comment.author.equals(currentUser)) {%>
          <div class="d-flex justify-content-end">
            <a
              href="/p/<%= foundPage._id %>/comments/<%= comment._id %>/edit"
              class="mx-1 btn btn-warning"
              >Edit</a
            >
            <form
              action="/p/<%= foundPage._id %>/comments/<%= comment._id %>?_method=DELETE"
              method="POST"
            >
              <button class="btn btn-danger">Delete</button>
            </form>
          </div>

          <% } %>
        </div>
      </div>

      <% } %>
    </div>
  </div>
</div>
